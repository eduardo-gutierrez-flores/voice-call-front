(this["webpackJsonpvoice-call-agora"]=this["webpackJsonpvoice-call-agora"]||[]).push([[0],{238:function(e,n,t){},239:function(e,n,t){},263:function(e,n){},265:function(e,n){},275:function(e,n){},277:function(e,n){},302:function(e,n){},303:function(e,n){},308:function(e,n){},310:function(e,n){},317:function(e,n){},336:function(e,n){},360:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),i=t(213),o=t.n(i),r=(t(238),t(16)),l=t(143),s=t(33),u=t(53),d=t(13),j=(t(239),t(222)),b=t(83),x=t.n(b),p=t(421),m=t(423),f=t(425),O=t(218),h=t.n(O),v=t(225),g=t(419),k=t(409),w=t(422),C=t(144),I=t(2),y=function(e){var n=e.user,t=e.initCall,a=e.rtc,i=e.callInProsess,o=e.userInCall,r=Object(c.useState)(o),l=Object(d.a)(r,2),j=l[0],b=l[1],O=n.id,y=C.RtcRole.PUBLISHER,E=Math.floor(Date.now()/1e3)+3600,S={appId:"0c962528da524ac1a646aa034f8b5385",channel:n.id},T=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){var c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=C.RtcTokenBuilder.buildTokenWithUid("0c962528da524ac1a646aa034f8b5385","88d7864ddaf34842813b3b9237670158",O,0,y,E),t(c,n.id,n.name),e.next=4,a.client.join(S.appId,S.channel,c,S.uid);case 4:return e.next=6,x.a.createMicrophoneAudioTrack();case 6:return a.localAudioTrack=e.sent,e.next=9,a.client.publish([a.localAudioTrack]);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){b(o)}),[o]),Object(I.jsxs)(m.a,{sx:{display:"flex",width:"300px",height:"70px",alignItems:"center",padding:"10px"},children:[Object(I.jsx)(k.a,{direction:"row",spacing:2,children:Object(I.jsx)(g.a,{children:function(e){var n=e.split(" ");return"".concat(n[0][0].toUpperCase()).concat(n[1]?n[1][0].toUpperCase():"")}(n.name)})}),Object(I.jsxs)(p.a,{sx:{display:"flex",flexDirection:"column",padding:"2rem"},children:[Object(I.jsx)(p.a,{sx:{display:"flex",alignItems:"center"},children:Object(I.jsx)(w.a,{variant:"h6",gutterBottom:!0,component:"div",children:function(e){var n=e.split(" ");return"".concat(n[0].charAt(0).toUpperCase()).concat(n[0].slice(1)," ").concat(n[1]?n[1].charAt(0).toUpperCase():"").concat(n[1]?n[1].slice(1):"")}(n.name)})}),null!==j&&void 0!==j&&j.some((function(e){return e===n.id}))||i?null:Object(I.jsx)(p.a,{sx:{display:"flex",alignItems:"center"},children:Object(I.jsx)(f.a,{"aria-label":"next",onClick:T,children:Object(I.jsx)(v.a,{component:h.a,inheritViewBox:!0,color:"green"})})})]})]})},E=t(420),S=t(413),T=t(417),A=t(418),B=t(415),_=t(426),P=t(103),L=t.n(P),U=t(219),R=t.n(U);function V(e){var n=e.open,t=e.reciveCall,c=e.declineCall,a=e.callInProsess,i=e.call;return Object(I.jsx)(p.a,{sx:{width:"100%"},children:Object(I.jsx)(_.a,{in:n,children:Object(I.jsxs)(B.a,{action:Object(I.jsxs)(p.a,{sx:{display:"flex",alignItems:"center"},children:[!a&&Object(I.jsx)(f.a,{"aria-label":"next",onClick:t,children:Object(I.jsx)(v.a,{component:R.a,inheritViewBox:!0,color:"green"})}),Object(I.jsx)(f.a,{"aria-label":"play/pause",onClick:c,children:Object(I.jsx)(v.a,{component:L.a,inheritViewBox:!0})})]}),sx:{mb:2},children:[a?"En llamada con":"Llamada entrante de"," ",null===i||void 0===i?void 0:i.nameEmit]})})})}var D=t(220),F=t.n(D);function M(e){var n=e.onClose,t=e.open,c=e.name;return Object(I.jsx)(p.a,{sx:{width:"100%"},children:Object(I.jsx)(_.a,{in:t,children:Object(I.jsxs)(B.a,{action:Object(I.jsx)(f.a,{"aria-label":"close",color:"inherit",size:"small",onClick:n,children:Object(I.jsx)(F.a,{fontSize:"inherit"})}),sx:{mb:2},severity:"info",children:[c," ha abandonado la llamada"]})})})}var z=t(221),J=t.n(z);function H(e){var n=e.open,t=e.declineCall,c=e.callInProsess,a=e.call;return Object(I.jsx)(p.a,{sx:{width:"100%"},children:Object(I.jsx)(_.a,{in:n,children:Object(I.jsxs)(B.a,{action:Object(I.jsxs)(p.a,{sx:{display:"flex",alignItems:"center"},children:[!c&&Object(I.jsx)(f.a,{"aria-label":"next",children:Object(I.jsx)(v.a,{component:J.a,inheritViewBox:!0,color:"green"})}),Object(I.jsx)(f.a,{"aria-label":"play/pause",onClick:t,children:Object(I.jsx)(v.a,{component:L.a,inheritViewBox:!0})})]}),sx:{mb:2},children:[c?"En llamada con ":"Llamando a "," ",null===a||void 0===a?void 0:a.name]})})})}var N=j.a.connect("https://voice-call-socket.herokuapp.com/");var W=function(){var e=Object(c.useState)(),n=Object(d.a)(e,2),t=n[0],a=n[1],i=Object(c.useState)([]),o=Object(d.a)(i,2),j=o[0],b=o[1],m=Object(c.useState)(""),f=Object(d.a)(m,2),O=f[0],h=f[1],v=Object(c.useState)({localAudioTrack:null,client:null}),g=Object(d.a)(v,2),k=g[0],C=g[1],B=Object(c.useState)(!1),_=Object(d.a)(B,2),P=_[0],L=_[1],U=Object(c.useState)(),R=Object(d.a)(U,2),D=R[0],F=R[1],z=Object(c.useState)([]),J=Object(d.a)(z,2),W=J[0],q=J[1],G=Object(c.useState)(),K=Object(d.a)(G,2),Q=K[0],X=K[1],Y=Object(c.useState)(!1),Z=Object(d.a)(Y,2),$=Z[0],ee=Z[1],ne={appId:"0c962528da524ac1a646aa034f8b5385",channel:"test"};Object(c.useLayoutEffect)((function(){var e=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=x.a.createClient({mode:"rtc",codec:"vp8"})).on("user-published",function(){var e=Object(u.a)(Object(s.a)().mark((function e(t,c){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t,c),e.next=3,n.subscribe(t,c);case 3:"audio"===c&&t.audioTrack.play(),n.on("user-unpublished",function(){var e=Object(u.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.unsubscribe(t);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),C((function(e){return Object(l.a)(Object(l.a)({},e),{},{client:n})}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var te=function(e,n,t){console.log("CALL TO ",t),L(!0),X({name:t,nameEmit:O,id:n,token:e,room:"".concat(n).concat(N.id)}),N.emit("create_call",{nameEmit:O,name:t,id:n,token:e,room:"".concat(n).concat(N.id)})},ce=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.client.join(ne.appId,t.id,t.token,ne.uid);case 2:return e.next=4,x.a.createMicrophoneAudioTrack();case 4:return k.localAudioTrack=e.sent,e.next=7,k.client.publish([k.localAudioTrack]);case 7:N.emit("answer_call",{id:t.id,idEmit:t.idEmit,room:t.room}),L(!0);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(!1),!k.localAudioTrack){e.next=5;break}return k.localAudioTrack.close(),e.next=5,k.client.leave();case 5:t&&N.emit("leave_call",{name:O,id:t.id,token:t.token,room:t.room,idEmit:t.idEmit}),Q&&N.emit("leave_call",{name:O,id:N.id,token:Q.token,room:Q.room,idEmit:Q.idEmit}),a(void 0),X(void 0);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){N.on("new_active",(function(e){console.log(e);var n=e.filter((function(e){return!j.some((function(n){return n.id===e.id}))&&e.id!==N.id}));b(Object(r.a)(n))})),N.on("recive_call",(function(e){console.log(e),a(e)})),N.on("leave",(function(e){console.log(e),F(e)})),N.on("users_in_call",(function(e){console.log(e,null===Q||void 0===Q?void 0:Q.id),e.some((function(e){return e===(null===Q||void 0===Q?void 0:Q.id)||e===(null===t||void 0===t?void 0:t.id)}))?L(!0):L(!1),q(e)}))}),[null===t||void 0===t?void 0:t.id,null===Q||void 0===Q?void 0:Q.id]),Object(I.jsxs)("div",{className:"App",children:[Object(I.jsx)(H,{open:void 0!==Q&&!D,call:Q,callInProsess:W.some((function(e){return e===(null===Q||void 0===Q?void 0:Q.id)})),declineCall:function(){N.emit("cancel_call",{name:O,id:Q.id,token:Q.token,room:Q.room,idEmit:Q.idEmit}),ae()}}),Object(I.jsx)(V,{open:void 0!==t&&!D,declineCall:function(){return ae()},reciveCall:function(){return ce()},callInProsess:P,call:t}),Object(I.jsx)(M,{open:void 0!==D,onClose:function(){ae(),F(void 0)},name:null===D||void 0===D?void 0:D.name}),Object(I.jsx)(E.a,{children:Object(I.jsx)(p.a,{sx:{width:"100%"},children:Object(I.jsxs)(T.a,{container:!0,rowSpacing:1,columnSpacing:{xs:1,sm:2,md:3},children:[Object(I.jsx)(T.a,{item:!0,xs:6,children:Object(I.jsxs)(p.a,{sx:{display:"flex",margin:"2rem auto",width:"300px",gap:"1rem",flexDirection:"column"},children:[Object(I.jsx)(w.a,{variant:"h6",gutterBottom:!0,component:"div",color:"green",children:"Usuarios Conectados"}),j.map((function(e){return Object(I.jsx)(y,{user:e,initCall:function(e,n,t){return te(e,n,t)},rtc:k,callInProsess:P,userInCall:W})}))]})}),Object(I.jsxs)(T.a,{item:!0,xs:6,children:[Object(I.jsx)(p.a,{sx:{margin:"2rem auto",width:"300px"},children:Object(I.jsx)(S.a,{onChange:function(e){return h(e.target.value)},variant:"standard",label:"Ingresa tu nombre"})}),$?Object(I.jsx)(w.a,{variant:"h6",gutterBottom:!0,component:"div",color:"green",children:"En linea"}):Object(I.jsx)(p.a,{sx:{margin:"0 auto",width:"300px"},children:Object(I.jsx)(A.a,{variant:"outlined",size:"small",onClick:function(){return N.emit("create_user",{name:O}),void ee(!0)},children:"Unirte"})})]})]})})})]})},q=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,428)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,i=n.getLCP,o=n.getTTFB;t(e),c(e),a(e),i(e),o(e)}))};o.a.createRoot(document.getElementById("root")).render(Object(I.jsx)(a.a.StrictMode,{children:Object(I.jsx)(W,{})})),q()}},[[360,1,2]]]);
//# sourceMappingURL=main.d674b124.chunk.js.map