(this["webpackJsonpvoice-call-agora"]=this["webpackJsonpvoice-call-agora"]||[]).push([[0],{237:function(e,n,t){},238:function(e,n,t){},262:function(e,n){},264:function(e,n){},274:function(e,n){},276:function(e,n){},301:function(e,n){},302:function(e,n){},307:function(e,n){},309:function(e,n){},316:function(e,n){},335:function(e,n){},359:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),i=t(213),r=t.n(i),o=(t(237),t(16)),l=t(143),s=t(30),u=t(50),d=t(13),j=(t(238),t(222)),b=t(84),p=t.n(b),x=t(421),f=t(422),O=t(425),m=t(218),h=t.n(m),v=t(69),k=t.n(v),g=t(225),w=t(419),C=t(409),y=t(424),I=t(144),E=t(2),S=function(e){var n=e.user,t=e.initCall,a=e.rtc,i=e.callInProsess,r=e.userInCall,o=Object(c.useState)(r),l=Object(d.a)(o,2),j=l[0],b=l[1],m=n.id,v=I.RtcRole.PUBLISHER,S=Math.floor(Date.now()/1e3)+3600,T={appId:"0c962528da524ac1a646aa034f8b5385",channel:n.id},A=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){var c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=I.RtcTokenBuilder.buildTokenWithUid("0c962528da524ac1a646aa034f8b5385","88d7864ddaf34842813b3b9237670158",m,0,v,S),t(c,n.id,n.name),e.next=4,a.client.join(T.appId,T.channel,c,T.uid);case 4:return e.next=6,p.a.createMicrophoneAudioTrack();case 6:return a.localAudioTrack=e.sent,e.next=9,a.client.publish([a.localAudioTrack]);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.localAudioTrack.close(),e.next=3,a.client.leave();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){b(r)}),[r]),Object(E.jsxs)(f.a,{sx:{display:"flex",width:"300px",height:"70px",alignItems:"center",padding:"10px"},children:[Object(E.jsx)(C.a,{direction:"row",spacing:2,children:Object(E.jsx)(w.a,{children:function(e){var n=e.split(" ");return"".concat(n[0][0].toUpperCase()).concat(n[1]?n[1][0].toUpperCase():"")}(n.name)})}),Object(E.jsxs)(x.a,{sx:{display:"flex",flexDirection:"column",padding:"2rem"},children:[Object(E.jsx)(x.a,{sx:{display:"flex",alignItems:"center"},children:Object(E.jsx)(y.a,{variant:"h6",gutterBottom:!0,component:"div",children:function(e){var n=e.split(" ");return"".concat(n[0].charAt(0).toUpperCase()).concat(n[0].slice(1)," ").concat(n[1]?n[1].charAt(0).toUpperCase():"").concat(n[1]?n[1].slice(1):"")}(n.name)})}),null!==j&&void 0!==j&&j.some((function(e){return e===n.id}))||i?null:Object(E.jsxs)(x.a,{sx:{display:"flex",alignItems:"center"},children:[Object(E.jsx)(O.a,{"aria-label":"next",onClick:A,children:Object(E.jsx)(g.a,{component:h.a,inheritViewBox:!0,color:"green"})}),Object(E.jsx)(O.a,{"aria-label":"play/pause",onClick:B,children:Object(E.jsx)(g.a,{component:k.a,inheritViewBox:!0})})]})]})]})},T=t(420),A=t(413),B=t(417),P=t(418),_=t(415),L=t(426),U=t(219),V=t.n(U);function R(e){var n=e.open,t=e.reciveCall,c=e.declineCall,a=e.callInProsess,i=e.call;return Object(E.jsx)(x.a,{sx:{width:"100%"},children:Object(E.jsx)(L.a,{in:n,children:Object(E.jsxs)(_.a,{action:Object(E.jsxs)(x.a,{sx:{display:"flex",alignItems:"center"},children:[!a&&Object(E.jsx)(O.a,{"aria-label":"next",onClick:t,children:Object(E.jsx)(g.a,{component:V.a,inheritViewBox:!0,color:"green"})}),Object(E.jsx)(O.a,{"aria-label":"play/pause",onClick:c,children:Object(E.jsx)(g.a,{component:k.a,inheritViewBox:!0})})]}),sx:{mb:2},children:[a?"En llamada con":"Llamada entrante de"," ",null===i||void 0===i?void 0:i.nameEmit]})})})}var D=t(220),F=t.n(D);function M(e){var n=e.onClose,t=e.open,c=e.name;return Object(E.jsx)(x.a,{sx:{width:"100%"},children:Object(E.jsx)(L.a,{in:t,children:Object(E.jsxs)(_.a,{action:Object(E.jsx)(O.a,{"aria-label":"close",color:"inherit",size:"small",onClick:n,children:Object(E.jsx)(F.a,{fontSize:"inherit"})}),sx:{mb:2},severity:"info",children:[c," ha abandonado la llamada"]})})})}var z=t(221),J=t.n(z);function H(e){var n=e.open,t=e.declineCall,c=e.callInProsess,a=e.call;return Object(E.jsx)(x.a,{sx:{width:"100%"},children:Object(E.jsx)(L.a,{in:n,children:Object(E.jsxs)(_.a,{action:Object(E.jsxs)(x.a,{sx:{display:"flex",alignItems:"center"},children:[!c&&Object(E.jsx)(O.a,{"aria-label":"next",children:Object(E.jsx)(g.a,{component:J.a,inheritViewBox:!0,color:"green"})}),Object(E.jsx)(O.a,{"aria-label":"play/pause",onClick:t,children:Object(E.jsx)(g.a,{component:k.a,inheritViewBox:!0})})]}),sx:{mb:2},children:[c?"En llamada con":"Llamando a "," ",null===a||void 0===a?void 0:a.name]})})})}var N=j.a.connect("https://voice-call-socket.herokuapp.com/");var W=function(){var e=Object(c.useState)(),n=Object(d.a)(e,2),t=n[0],a=n[1],i=Object(c.useState)([]),r=Object(d.a)(i,2),j=r[0],b=r[1],f=Object(c.useState)(""),O=Object(d.a)(f,2),m=O[0],h=O[1],v=Object(c.useState)({localAudioTrack:null,client:null}),k=Object(d.a)(v,2),g=k[0],w=k[1],C=Object(c.useState)(!1),y=Object(d.a)(C,2),I=y[0],_=y[1],L=Object(c.useState)(),U=Object(d.a)(L,2),V=U[0],D=U[1],F=Object(c.useState)([]),z=Object(d.a)(F,2),J=z[0],W=z[1],q=Object(c.useState)(),G=Object(d.a)(q,2),K=G[0],Q=G[1],X={appId:"0c962528da524ac1a646aa034f8b5385",channel:"test"};Object(c.useLayoutEffect)((function(){var e=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=p.a.createClient({mode:"rtc",codec:"vp8"})).on("user-published",function(){var e=Object(u.a)(Object(s.a)().mark((function e(t,c){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t,c),e.next=3,n.subscribe(t,c);case 3:"audio"===c&&t.audioTrack.play(),n.on("user-unpublished",function(){var e=Object(u.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.unsubscribe(t);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),w((function(e){return Object(l.a)(Object(l.a)({},e),{},{client:n})}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var Y=function(e,n,t){console.log("CALL TO ",t),_(!0),Q({name:t,nameEmit:m,id:n,token:e,room:"".concat(n).concat(N.id)}),N.emit("create_call",{nameEmit:m,name:t,id:n,token:e,room:"".concat(n).concat(N.id)})},Z=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.client.join(X.appId,t.id,t.token,X.uid);case 2:return e.next=4,p.a.createMicrophoneAudioTrack();case 4:g.localAudioTrack=e.sent,N.emit("answer_call",{id:t.id,idEmit:t.idEmit,room:t.room}),_(!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=Object(u.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_(!1),!g.localAudioTrack){e.next=5;break}return g.localAudioTrack.close(),e.next=5,g.client.leave();case 5:t&&N.emit("leave_call",{name:m,id:t.id,token:t.token,room:t.room,idEmit:t.idEmit}),K&&N.emit("leave_call",{name:m,id:N.id,token:K.token,room:K.room,idEmit:K.idEmit}),a(void 0),Q(void 0);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){N.on("new_active",(function(e){b((function(n){return[].concat(Object(o.a)(n.filter((function(n){return n.id!==e.id}))),[e])}))})),N.on("recive_call",(function(e){console.log(e),a(e)})),N.on("leave",(function(e){console.log(e),D(e)})),N.on("users_in_call",(function(e){console.log(e,null===K||void 0===K?void 0:K.id),e.some((function(e){return e===(null===K||void 0===K?void 0:K.id)||e===(null===t||void 0===t?void 0:t.id)}))?_(!0):_(!1),W(e)}))}),[null===t||void 0===t?void 0:t.id,null===K||void 0===K?void 0:K.id]),Object(E.jsxs)("div",{className:"App",children:[Object(E.jsx)(H,{open:void 0!==K&&!V,call:K,callInProsess:J.some((function(e){return e===(null===K||void 0===K?void 0:K.id)})),declineCall:$}),Object(E.jsx)(R,{open:void 0!==t&&!V,declineCall:function(){return $()},reciveCall:function(){return Z()},callInProsess:I,call:t}),Object(E.jsx)(M,{open:void 0!==V,onClose:function(){$(),D(void 0)},name:null===V||void 0===V?void 0:V.name}),Object(E.jsx)(T.a,{children:Object(E.jsx)(x.a,{sx:{width:"100%"},children:Object(E.jsxs)(B.a,{container:!0,rowSpacing:1,columnSpacing:{xs:1,sm:2,md:3},children:[Object(E.jsx)(B.a,{item:!0,xs:6,children:Object(E.jsx)(x.a,{sx:{display:"flex",margin:"2rem auto",width:"300px",gap:"1rem",flexDirection:"column"},children:j.map((function(e){return Object(E.jsx)(S,{user:e,initCall:function(e,n,t){return Y(e,n,t)},rtc:g,callInProsess:I,userInCall:J})}))})}),Object(E.jsxs)(B.a,{item:!0,xs:6,children:[Object(E.jsx)(x.a,{sx:{margin:"2rem auto",width:"300px"},children:Object(E.jsx)(A.a,{onChange:function(e){return h(e.target.value)},variant:"standard",label:"Ingresa tu nombre"})}),Object(E.jsx)(x.a,{sx:{margin:"0 auto",width:"300px"},children:Object(E.jsx)(P.a,{variant:"outlined",size:"small",onClick:function(){N.emit("create_user",{name:m})},children:"Unirte"})})]})]})})})]})},q=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,428)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,i=n.getLCP,r=n.getTTFB;t(e),c(e),a(e),i(e),r(e)}))};r.a.createRoot(document.getElementById("root")).render(Object(E.jsx)(a.a.StrictMode,{children:Object(E.jsx)(W,{})})),q()}},[[359,1,2]]]);
//# sourceMappingURL=main.f82c5ac7.chunk.js.map